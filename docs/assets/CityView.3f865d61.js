import{r as I,au as G,_ as H,F as s,G as d,M as _,N as T,J as p,K as b,a6 as M,a7 as U,R as u,a3 as B,a2 as E,b as y,Y as v,Z as k,ac as P,U as q,T as z,f as w,a as O,o as J,ae as j,al as K,av as X}from"./index.f793904c.js";import{g as Y}from"./getCinemaList.88ed5cf0.js";const L=I({data:[]}),V=I({data:[]}),x=I({data:{}}),F=I({data:[]});async function Z(){const{cities:a}=await G({url:"/gateway",XHost:"mall.film-ticket.city.list"});L.data=a,Q()}function Q(){let a={},o=null;for(let e=65;e<91;e++)o=String.fromCharCode(e),a[o]=null;L.data.forEach(e=>{const t=e.pinyin.charAt(0).toUpperCase();a[t]||(a[t]=[]),a[t].push(e),e.isHot&&F.data.push(e)});for(let e in a)a[e]||delete a[e];V.data=Object.keys(a),$(a)}function $(a){const e=V.data.length,t=Math.ceil(e/5);let i=0,c={};n();function n(){if(i<e)for(let l in a)c[l]=a[l],i+=1,i===t&&Object.assign(x.data,c),(i%t===0&&i>t||i===e)&&setTimeout(()=>{Object.assign(x.data,c)},1/60)}}const tt={props:{curLocation:{type:Object,default:()=>{}},hotCities:{type:Array,default:()=>[]}},emits:["chooseCity"],setup(a,o){function e(t){o.emit("chooseCity",t)}return{chooseCity:e}}},N=a=>(M("data-v-9866cd5e"),a=a(),U(),a),et={class:"locate-and-hot"},at=N(()=>_("p",null,"GPS\u5B9A\u4F4D\u4F60\u6240\u5728\u7684\u57CE\u5E02",-1)),ot=["data-cityid","data-cityname"],nt=N(()=>_("p",null,"\u70ED\u95E8\u57CE\u5E02",-1)),it={class:"hot-citys"},st=["data-cityid","data-cityname"];function ct(a,o,e,t,i,c){return s(),d("div",et,[at,_("span",{class:"location","data-cityid":e.curLocation.cityId,"data-cityname":e.curLocation.name,onClick:o[0]||(o[0]=(...n)=>t.chooseCity&&t.chooseCity(...n))},T(e.curLocation.name||"\u5B9A\u4F4D\u5931\u8D25"),9,ot),nt,_("ul",it,[(s(!0),d(p,null,b(e.hotCities,n=>(s(),d("li",{class:"hot-item",key:n.cityId,"data-cityid":n.cityId,"data-cityname":n.name,onClick:o[1]||(o[1]=(...l)=>t.chooseCity&&t.chooseCity(...l))},T(n.name),9,st))),128))])])}var lt=H(tt,[["render",ct],["__scopeId","data-v-9866cd5e"]]);const rt={props:{firstWords:{type:Array,default:()=>[]},letterTable:{type:Object,default:()=>{}},stickyHeaderHeight:Number},emits:["chooseCity"],setup(a,o){function e(t){o.emit("chooseCity",t)}return{chooseCity:e}}};function dt(a,o,e,t,i,c){const n=u("van-index-anchor"),l=u("van-cell"),C=u("van-index-bar");return s(),B(C,{class:"index-bar","index-list":e.firstWords,"highlight-color":"#FF4040",sticky:!0,"sticky-offset-top":e.stickyHeaderHeight},{default:E(()=>[(s(!0),d(p,null,b(e.letterTable,(m,h)=>(s(),d(p,{key:h},[y(n,{index:h},null,8,["index"]),_("div",{onClickCapture:o[0]||(o[0]=(...r)=>t.chooseCity&&t.chooseCity(...r))},[(s(!0),d(p,null,b(m,r=>(s(),B(l,{title:r.name,key:r.cityId,"data-cityid":r.cityId,"data-cityname":r.name},null,8,["title","data-cityid","data-cityname"]))),128))],32)],64))),128))]),_:1},8,["index-list","sticky-offset-top"])}var ut=H(rt,[["render",dt],["__scopeId","data-v-1b2bd7c4"]]);const _t={props:{resultList:{type:Array,default:()=>[]}},emits:["chooseCity"],setup(a,o){function e(t){o.emit("chooseCity",t)}return{chooseCity:e}}},yt={class:"search-result"},ht=["data-cityid","data-cityname"],ft={class:"no-result"};function Ct(a,o,e,t,i,c){return s(),d("div",yt,[v(_("ul",{class:"result-list",onClick:o[0]||(o[0]=(...n)=>t.chooseCity&&t.chooseCity(...n))},[(s(!0),d(p,null,b(e.resultList,n=>(s(),d("li",{key:n.cityId,class:"result-item","data-cityid":n.cityId,"data-cityname":n.name},T(n.name),9,ht))),128))],512),[[k,e.resultList.length>0]]),v(_("div",ft," \u6CA1\u6709\u627E\u5230\u5339\u914D\u7684\u7ED3\u679C ",512),[[k,!e.resultList]])])}var mt=H(_t,[["render",Ct],["__scopeId","data-v-6b1d1cea"]]);const pt={components:{NavBar:P,LocationAndHot:lt,CityList:ut,SearchResult:mt},setup(a){const o=q(),e=z(),t=w(""),i=w(null),c=w(0),n=O(()=>{if(t.value)return L.data.filter(f=>{const g=f.pinyin.charAt(0);return f.name.includes(t.value)||g.includes(t.value)})}),l=O(()=>Object.keys(x.data).length>0);Z();async function C(f){let g=null;for(let A of f.path)if(A.dataset.cityid){g=A.dataset;break}const{cityid:S,cityname:W}=g,{fromPath:R,ticketFlag:D}=e.query;if(S!=j.city.id)switch(K.updateCityInfo({cityId:S,name:W}),R){case"/":X();break;case"/cinemas":Y({cityId:S,ticketFlag:D});break}o.back()}function m(){}function h(){t.value=""}function r(){o.back()}return J(()=>{c.value=i.value.offsetHeight}),{store:j,city:L,firstWords:V,letterTable:x,hotCity:F,inputValue:t,stickyHeader:i,stickyHeaderHeight:c,isLetterTableDone:l,resultList:n,goBack:r,chooseCity:C,onSearch:m,onCancel:h}}},vt={class:"city-view"},kt={class:"sticky-header",ref:"stickyHeader"},gt={class:"normal-content"};function bt(a,o,e,t,i,c){const n=u("nav-bar"),l=u("van-search"),C=u("location-and-hot"),m=u("city-list"),h=u("my-loading"),r=u("search-result");return s(),d("div",vt,[_("div",kt,[y(n,{title:`\u5F53\u524D\u57CE\u5E02-${t.store.city.name}`,leftIconName:"close",leftIconSize:18,isShowLeftText:!1,onOnClickLeft:t.goBack},null,8,["title","onOnClickLeft"]),y(l,{modelValue:t.inputValue,"onUpdate:modelValue":o[0]||(o[0]=f=>t.inputValue=f),"show-action":!!t.inputValue,placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0\u6216\u62FC\u97F3",onSearch:t.onSearch,onCancel:t.onCancel},null,8,["modelValue","show-action","onSearch","onCancel"])],512),v(_("div",gt,[y(C,{curLocation:t.store.city,hotCities:t.hotCity.data,onChooseCity:t.chooseCity},null,8,["curLocation","hotCities","onChooseCity"]),y(m,{firstWords:t.firstWords.data,letterTable:t.letterTable.data,"sticky-header-height":t.stickyHeaderHeight,onChooseCity:t.chooseCity},null,8,["firstWords","letterTable","sticky-header-height","onChooseCity"]),v(y(h,{position:"absolute"},null,512),[[k,!t.isLetterTableDone]])],512),[[k,!t.inputValue]]),v(y(r,{resultList:t.resultList,onChooseCity:t.chooseCity},null,8,["resultList","onChooseCity"]),[[k,t.inputValue]])])}var It=H(pt,[["render",bt],["__scopeId","data-v-041c8076"]]);export{It as default};
