import{c as de,d as me,m as Z,n as G,r as j,u as ke,a as V,w as X,b as u,I as Pe,S as Ie,p as K,e as Y,L as De,f as b,g as He,o as ue,h as Te,i as Ae,j as O,k as Be,l as ve,q as Xe,P as Ne,t as W,s as Ye,v as E,x as J,y as Q,z as ze,A as Re,H as Ze,B as Ve,C as We,D as Ee,E as Fe,_ as M,F as y,G as k,J as he,K as fe,M as c,N as w,O as _e,Q as ge,R as T,T as Me,U as $e,V as Le,W as Oe,X as je,Y as ee,Z as oe,$ as L,a0 as te,a1 as qe,a2 as Ue,a3 as ae,a4 as Ge,a5 as Ke,a6 as Je,a7 as Qe}from"./index.b6e75293.js";import{m as eo,u as oo}from"./mount-component.dff51640.js";const ne=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),se=de("image-preview")[1];var to=me({props:{src:String,show:Boolean,active:Number,minZoom:Z(G),maxZoom:Z(G),rootWidth:Z(Number),rootHeight:Z(Number)},emits:["scale","close"],setup(e,{emit:a}){const o=j({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),t=ke(),s=V(()=>{const{rootWidth:n,rootHeight:d}=e,v=d/n;return o.imageRatio>v}),_=V(()=>{const{scale:n,moveX:d,moveY:v,moving:I,zooming:A}=o,R={transitionDuration:A||I?"0s":".3s"};if(n!==1){const Ce=d/n,be=v/n;R.transform=`scale(${n}, ${n}) translate(${Ce}px, ${be}px)`}return R}),l=V(()=>{if(o.imageRatio){const{rootWidth:n,rootHeight:d}=e,v=s.value?d/o.imageRatio:n;return Math.max(0,(o.scale*v-n)/2)}return 0}),r=V(()=>{if(o.imageRatio){const{rootWidth:n,rootHeight:d}=e,v=s.value?d:n*o.imageRatio;return Math.max(0,(o.scale*v-d)/2)}return 0}),h=n=>{n=Y(n,+e.minZoom,+e.maxZoom+1),n!==o.scale&&(o.scale=n,a("scale",{scale:n,index:e.active}))},p=()=>{h(1),o.moveX=0,o.moveY=0},x=()=>{const n=o.scale>1?1:2;h(n),o.moveX=0,o.moveY=0};let S,f,P,D,H,i,m;const g=n=>{const{touches:d}=n,{offsetX:v}=t;t.start(n),S=d.length,f=o.moveX,P=o.moveY,m=Date.now(),o.moving=S===1&&o.scale!==1,o.zooming=S===2&&!v.value,o.zooming&&(D=o.scale,H=ne(n.touches))},C=n=>{const{touches:d}=n;if(t.move(n),(o.moving||o.zooming)&&K(n,!0),o.moving){const{deltaX:v,deltaY:I}=t,A=v.value+f,R=I.value+P;o.moveX=Y(A,-l.value,l.value),o.moveY=Y(R,-r.value,r.value)}if(o.zooming&&d.length===2){const v=ne(d),I=D*v/H;h(I)}},$=()=>{if(S>1)return;const{offsetX:n,offsetY:d}=t,v=Date.now()-m,I=250,A=5;n.value<A&&d.value<A&&v<I&&(i?(clearTimeout(i),i=null,x()):i=setTimeout(()=>{a("close"),i=null},I))},N=n=>{let d=!1;(o.moving||o.zooming)&&(d=!0,o.moving&&f===o.moveX&&P===o.moveY&&(d=!1),n.touches.length||(o.zooming&&(o.moveX=Y(o.moveX,-l.value,l.value),o.moveY=Y(o.moveY,-r.value,r.value),o.zooming=!1),o.moving=!1,f=0,P=0,D=1,o.scale<1&&p(),o.scale>e.maxZoom&&(o.scale=+e.maxZoom))),K(n,d),$(),t.reset()},xe=n=>{const{naturalWidth:d,naturalHeight:v}=n.target;o.imageRatio=v/d};return X(()=>e.active,p),X(()=>e.show,n=>{n||p()}),()=>{const n={loading:()=>u(De,{type:"spinner"},null)};return u(Ie,{class:se("swipe-item"),onTouchstart:g,onTouchmove:C,onTouchend:N,onTouchcancel:N},{default:()=>[u(Pe,{src:e.src,fit:"contain",class:se("image",{vertical:s.value}),style:_.value,onLoad:xe},n)]})}}});const[ao,B]=de("image-preview"),no=["show","transition","overlayStyle","closeOnPopstate"],so={show:Boolean,loop:W,images:Ye(),minZoom:E(1/3),maxZoom:E(3),overlay:W,closeable:Boolean,showIndex:W,className:J,closeIcon:Q("clear"),transition:String,beforeClose:Function,overlayClass:J,overlayStyle:Object,swipeDuration:E(300),startPosition:E(0),showIndicators:Boolean,closeOnPopstate:W,closeIconPosition:Q("top-right")};var pe=me({name:ao,props:so,emits:["scale","close","closed","change","update:show"],setup(e,{emit:a,slots:o}){const t=b(),s=j({active:0,rootWidth:0,rootHeight:0}),_=()=>{if(t.value){const i=ze(t.value.$el);s.rootWidth=i.width,s.rootHeight=i.height,t.value.resize()}},l=i=>a("scale",i),r=i=>a("update:show",i),h=()=>{Re(e.beforeClose,{args:[s.active],done:()=>r(!1)})},p=i=>{i!==s.active&&(s.active=i,a("change",i))},x=()=>{if(e.showIndex)return u("div",{class:B("index")},[o.index?o.index({index:s.active}):`${s.active+1} / ${e.images.length}`])},S=()=>{if(o.cover)return u("div",{class:B("cover")},[o.cover()])},f=()=>u(Be,{ref:t,lazyRender:!0,loop:e.loop,class:B("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:p},{default:()=>[e.images.map(i=>u(to,{src:i,show:e.show,active:s.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:s.rootWidth,rootHeight:s.rootHeight,onScale:l,onClose:h},null))]}),P=()=>{if(e.closeable)return u(Ve,{role:"button",name:e.closeIcon,class:[B("close-icon",e.closeIconPosition),Ze],onClick:h},null)},D=()=>a("closed"),H=(i,m)=>{var g;return(g=t.value)==null?void 0:g.swipeTo(i,m)};return He({swipeTo:H}),ue(_),X([Te,Ae],_),X(()=>e.startPosition,i=>p(+i)),X(()=>e.show,i=>{const{images:m,startPosition:g}=e;i?(p(+g),O(()=>{_(),H(+g,{immediate:!0})})):a("close",{index:s.active,url:m[s.active]})}),()=>u(Ne,ve({class:[B(),e.className],overlayClass:[B("overlay"),e.overlayClass],onClosed:D,"onUpdate:show":r},Xe(e,no)),{default:()=>[P(),f(),x(),S()]})}});let F;const lo={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function io(){({instance:F}=eo({setup(){const{state:e,toggle:a}=oo(),o=()=>{e.images=[]};return()=>u(pe,ve(e,{onClosed:o,"onUpdate:show":a}),null)}}))}const z=(e,a=0)=>{if(!!We)return F||io(),e=Array.isArray(e)?{images:e,startPosition:a}:e,F.open(Ee({},lo,e)),F};z.Component=Fe(pe);z.install=e=>{e.use(z.Component)};const q={props:{photos:{type:Array,default:()=>[]},width:{type:String,default:"80px"},height:{type:String,default:"100px"},imagePreview:{type:Boolean,default:!1}},setup(e){function a(t){return t.avatarAddress?t.avatarAddress:t}function o(){e.imagePreview&&z({images:e.photos})}return{handleImg:a,handleImagePreview:o}}},le=()=>{ge(e=>({"7b71a488":e.width,"6ccf8ff1":e.height}))},ie=q.setup;q.setup=ie?(e,a)=>(le(),ie(e,a)):le;const co=q,ro=["src"],mo={key:0,class:"actor-relate"},uo={class:"actor-name"};function vo(e,a,o,t,s,_){return y(),k("ul",{class:"photo-list",onClickCapture:a[0]||(a[0]=(...l)=>t.handleImagePreview&&t.handleImagePreview(...l))},[(y(!0),k(he,null,fe(o.photos,l=>(y(),k("li",{key:l,class:"photo-item"},[c("img",{src:t.handleImg(l),alt:"",class:"img"},null,8,ro),l.name?(y(),k("div",mo,[c("div",uo,w(l.name),1),c("div",null,w(l.role),1)])):_e("",!0)]))),128))],32)}var we=M(co,[["render",vo],["__scopeId","data-v-0b8dcd1f"]]);const ho={emits:["handleBack"],props:{title:String},setup(e,a){function o(t){a.emit("handleBack",t)}return{handleBack:o}}},fo={class:"nav-header"},_o={class:"title"};function go(e,a,o,t,s,_){const l=T("van-icon");return y(),k("div",fo,[u(l,{class:"icon","class-prefix":"myicon",name:"back",size:"25",color:"grey",onClick:t.handleBack},null,8,["onClick"]),c("div",_o,w(o.title),1)])}var ye=M(ho,[["render",go],["__scopeId","data-v-783b2efa"]]);const U={components:{NavHeader:ye,GalleryCom:we},props:{photos:{type:Array,default:()=>[]},modelValue:{type:Boolean}},emits:["update:modelValue"],setup(e,a){const o=b(null),t=b(0);function s(l){a.emit("update:modelValue",!1)}function _(l){const r=l.target.dataset.index;r!==void 0&&z({images:e.photos,startPosition:r})}return ue(()=>{t.value=`${o.value.$el.offsetHeight}px`}),{navHeader:o,headerHeight:t,handleBack:s,handlePreview:_}}},ce=()=>{ge(e=>({"423f339f":e.headerHeight}))},re=U.setup;U.setup=re?(e,a)=>(ce(),re(e,a)):ce;const po=U,wo={class:"album"},yo=["src","data-index"];function So(e,a,o,t,s,_){const l=T("nav-header");return y(),k("div",wo,[u(l,{title:`\u5267\u7167(${o.photos.length})`,ref:"navHeader",onHandleBack:t.handleBack},null,8,["title","onHandleBack"]),c("ul",{class:"photo-list",onClickCapture:a[0]||(a[0]=(...r)=>t.handlePreview&&t.handlePreview(...r))},[(y(!0),k(he,null,fe(o.photos,(r,h)=>(y(),k("li",{key:r,class:"photo-item"},[c("img",{src:r,alt:"",class:"photo","data-index":h},null,8,yo)]))),128))],32)])}var xo=M(po,[["render",So],["__scopeId","data-v-6f3c79c6"]]);const Co={name:"FilmDetail",components:{GalleryCom:we,NavHeader:ye,AlbumCom:xo},setup(e){const a=Me(),o=$e(),t=j({data:{}}),s=b(!1),_=b(null),l=b(null),r=b(!1);let h=0;const p=b(0),x=b(!0);S();async function S(){const{film:m}=await Le({url:"/gateway",filmId:a.query.filmId,k:1584083,XHost:"mall.film-ticket.film.info"});t.data=m,O(()=>{_.value=`${l.value.offsetHeight}px`,s.value=!s.value})}function f(m){let g="";for(let C=0;C<m.length;C++)m[C].charCodeAt()<1e4?g+=` ${m[C]} `:g+=m[C];return g}function P(m){o.back()}function D(){p.value=h,r.value=!r.value,setTimeout(()=>{x.value=!1},500)}function H(){O(()=>{window.scrollTo(0,p.value),x.value=!0})}function i(m,g){function C($){$.preventDefault(),h=document.documentElement.scrollTop|document.body.scrollTop;const N=h/m.offsetHeight;m.style.backgroundColor=`rgba(255,255,255,${N})`,m.style.color=`rgba(105,105,105,${N})`}return Ge(C,50,g)}return X(()=>r.value,(m,g)=>{m||H()}),{synopsis:l,realHeight:_,filmDetail:t,isHidden:s,isShowNH:x,isShowAlbum:r,scrollTop:p,formatTime:Oe,formatCategory:f,handleBack:P,handleShowAlbum:D,onScroll:i}},directives:{scroll:{mounted(e,a){e.style.color="transparent",window.addEventListener("scroll",a.value(e,!0))},unmounted(e,a){window.removeEventListener("scroll",a.value(e,!1))}}}},Se=e=>(Je("data-v-213ab53c"),e=e(),Qe(),e),bo={class:"film-info"},ko={class:"info-header"},Po={class:"tag"},Io={class:"grade-box"},Do={class:"grade"},Ho=Ke("\u5206 "),To={class:"category"},Ao={class:"date"},Bo={class:"nation"},Xo={class:"actors commonStyle"},No=Se(()=>c("div",null,"\u6F14\u804C\u4EBA\u5458",-1)),Yo={class:"photos commonStyle"},zo={class:"header"},Ro=Se(()=>c("span",null,"\u5267\u7167",-1));function Zo(e,a,o,t,s,_){const l=T("nav-header"),r=T("van-icon"),h=T("gallery-com"),p=T("album-com"),x=T("my-loading"),S=je("scroll");return t.filmDetail.data.poster?(y(),k("div",{key:0,style:L({top:`-${t.scrollTop}px`}),class:te(["film-detail",{active:t.isShowAlbum}]),onScroll:a[3]||(a[3]=(...f)=>e.onPageScroll&&e.onPageScroll(...f))},[ee(u(l,{title:t.filmDetail.data.name,onHandleBack:t.handleBack},null,8,["title","onHandleBack"]),[[oe,t.isShowNH],[S,t.onScroll]]),c("div",{class:"cover",style:L(`background-image:url(${t.filmDetail.data.poster})`)},null,4),c("div",bo,[c("div",ko,[c("span",null,w(t.filmDetail.data.name),1),c("span",Po,w(t.filmDetail.data.filmType.name),1),ee(c("div",Io,[c("span",Do,w(t.filmDetail.data.grade),1),Ho],512),[[oe,t.filmDetail.data.grade]])]),c("div",To,w(t.formatCategory(t.filmDetail.data.category)),1),c("div",Ao,w(t.formatTime(t.filmDetail.data.premiereAt)),1),c("div",Bo,w(t.filmDetail.data.nation)+" | "+w(t.filmDetail.data.runtime)+"\u5206\u949F ",1),c("div",{ref:"synopsis",style:L(`height:${t.realHeight}`),class:te(["synopsis",{hidden:t.isHidden}])},w(t.filmDetail.data.synopsis),7),u(r,{"class-prefix":"myicon",name:t.isHidden?"moreunfold":"less",class:"arrow",onClick:a[0]||(a[0]=f=>t.isHidden=!t.isHidden)},null,8,["name"])]),c("div",Xo,[No,u(h,{photos:t.filmDetail.data.actors},null,8,["photos"])]),c("div",Yo,[c("div",zo,[Ro,c("div",{class:"header-right",onClick:a[1]||(a[1]=(...f)=>t.handleShowAlbum&&t.handleShowAlbum(...f))},[c("span",null,"\u5168\u90E8("+w(t.filmDetail.data.photos.length)+")",1),u(r,{"class-prefix":"myicon",name:"more",size:"14"})])]),u(h,{photos:t.filmDetail.data.photos,width:"140px",height:"100px",imagePreview:!0},null,8,["photos"])]),u(qe,{name:"slide"},{default:Ue(()=>[t.isShowAlbum?(y(),ae(p,{key:0,photos:t.filmDetail.data.photos,modelValue:t.isShowAlbum,"onUpdate:modelValue":a[2]||(a[2]=f=>t.isShowAlbum=f)},null,8,["photos","modelValue"])):_e("",!0)]),_:1})],38)):(y(),ae(x,{key:1,position:"fixed"}))}var Eo=M(Co,[["render",Zo],["__scopeId","data-v-213ab53c"]]);export{Eo as default};
